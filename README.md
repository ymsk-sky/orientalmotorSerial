# ModbusによるPLC経由でのモータ制御
オリエンタルモーターAZシリーズをシリアルで動作させる。


# ModbusTest.py
コピペしました。
Qiita [Modbusを使ってPLC経由でモータを制御する](https://qiita.com/ToyoshiMorioka/items/8f92121f6bf6b9b6d9a0)

## 使い方
1. git clone
2. pip install pyserial
3. python ModbusTest.py

COMポートは都度書き換えること。

# pyControl.py
メイン。

## ダイレクトデータ運転
通常運転より操作できるパラメータが少ないが、書き込みと同時に動作開始する。
パラメータは以下の7項目。
- データNo.
- 方式
- 位置
- 速度
- 起動・変速レート
- 停止レート
- 運転電流

## ドライバ出力状態
ドライバI/Oの出力状態を取得しその値に応じて動作を変更する。

### CRC-16/Modbusの計算
実装しました。以下アルゴリズム。

1. 初期値をFFFFhとし、FFFFhと最初のアドレス(8ビット)の排他的論理和(XOR)を計算
2. 1.の結果を1bit右シフト。これを桁あふれが1になるまで繰り返す
3. 2.の結果とA001hのXORを計算
4. シフトが8回になるまで2.と3.を繰り返す
5. 4.の結果と次のアドレス(8ビット)のXORを計算。すべてのバイトに対して2.から4.を繰り返す。最後の計算結果がCRC-16の計算結果となる。
